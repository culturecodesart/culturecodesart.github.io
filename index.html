<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>CULTURE CODES</title>
    <link rel="icon" href = "favicon-32.png" sizes="32x32">
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
	<style>
		body {
			font-family: 'Montserrat';font-size: 18px;
			background-image: url('sea3.jpg');
			background-size: cover;
			}
	</style>	
</head>
<body style="background-color:rgb(255, 255, 255);">
    <style>
        .meta-gray {
            -webkit-filter: grayscale(1);
        }
        .meta-normal {
            -webkit-filter: grayscale(0);
        }
    </style>

    <div class="container">
        <div style="margin-top: 10px;" class="row text-center">
            <div class="col-md-12">
                <h2><span style="color:darkblue;font-size:80px"><b>Culture Codes</b></span></h2>
            </div>            
        </div>

        </div>
	    
	    
		<br>
	
	
        <section class="contract-section hidden">
            <div style="margin-top: 30px;color:darkblue;" class="row text-center">
                <div class="col-md-12">
                    <h3>Tokens Migration</h3>
                </div>
            </div>
			
            <div class="row text-center">
                <div class="col-md-12">
                    <span>Price:<br>Free for Holders, only transaction fee,<br>Public Mint price TBA for non claimed<i id="priceEach"></i></span>
                </div>
            </div>
			
            <div class="row text-center">
                <div class="col-md-12">
                    <span>Remaining to Migrate: <i id="getRemaining"></i></span>
                </div>
            </div>
			
            <div class="row text-center">
                <div class="col-md-12">
                    <span>Currently Migrated: <i id="getSupply"></i></span>
                </div>
            </div>
            <div class="row text-center">
                <div class="col-md-12">
                    <span>Gas Price: <i id="showgas"></i></span>
					<button id="updategas" class="btn btn-info btn-sm">update</button></span>
                </div>
            </div>

		
		
	<div style="margin-top: 10px;" class="row text-center">
		<div class="col-md-12">
                	<button id="enableMetamask" class="btn btn-primary"><b>Connect Metamask</b</button>
            	</div>
	</div>
        <div class="row text-center">
            <div class="col-md-12">
                <span id="status"></span>
            </div>
        </div>
	<br><br>
			
            <div class="row text-center">
                <div class="col-md-12">							
					<button id="btnMintHolder" class="btn btn-primary"><b>Migrate Unique Token</b</button></span>
                </div>
            </div>
			<br>
			<br>
			
			<div class="row text-center">
                <div class="col-md-12">							
					<button id="btnMintHolderBatch" class="btn btn-primary"><b>Migrate All Tokens</b</button></span>
                </div>
            </div>
			
			
            <div class="row text-center">
                <div class="col-md-12">
                    <span><i id="txResult"></i></span>
                </div>
            </div>
			<br>
			<br>			
            <div class="row text-center">
				<div class="col-md-4"></div>
                <div class="col-md-4">
                    <span style="color:darkblue;font-size:18px;">Address Token Balance <input id="queryAddress" type="string" class="form-control" style="background:gainsboro" >
					<button id="btngetBalance" class="btn btn-primary">Get Balance of Address</button>
					</span>
                </div>
				<div class="col-md-4"></div>
            </div>
            <div class="row text-center">
                <div class="col-md-12">
                    <span style="color:darkblue;font-size:18px;"><i id="showBalance"></i> Tokens Owned</span>
                </div>
            </div>			
			<br>
	
	   	


		    
	  
	
	
			


			<div class="row text-center">
			    <div class="col-md-3" style="color:darkblue" >

                </div>
                <div class="col-md-6" style="color:darkblue" >
					<p class="text-center">				
                    <br>
					<span><b>MIGRATION PROCESS</b>
					<p class="text-justify">
					<br> Holders of a single Token migrate using the first option.
					<br>
					<br> Holder of many Tokens can migrate them one by one or select batch minting to migrate remaining tokens.	
					<br>					
					<br> Migrated tokens will be instant revealed and ready to list on opensea.					
					<br>
					<br>Migration process is open only for 30 days. Any Change in dates will be anounnced on Discord.					
					<br>
					<br>Legacy Tokens will stay available in OpenSea. No burning requiered.
					</span>
					</p>
					
					</span>
                </div>
				<div class="col-md-3" style="color:darkblue" >

                </div>
			</div>

					
					
					</span>
                </div>
			</div>


			
			<div class="row text-center">			
				<a href="https://opensea.io/collection/culturecodes"
					<div class="col-md-12" style="color:darkblue">
						<span><i id="linkOpensea"></i><b>Visit Opensea</b></span>
					</div>
				</a>
			</div>
			<div class="row text-center">
				<a href="https://twitter.com/Culture_Codes"
					<div class="col-md-12" style="color:darkblue">
						<span><i id="linkTwitter"></i><b>Follow on Twitter</b></span>
					</div>
				</a>
			</div>
			<div class="row text-center">
				<a href="https://discord.com/invite/RfcuwDCGV8"
					<div class="col-md-12" style="color:darkblue">
						<span><i id="linkDiscord"></i><b>Join Discord</b></span>
					</div>
				</a>
			</div>
        </section>
			
    </div>
	
	
    <script>
        let currentAccount = null;
        let web3;
        let abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"collection","type":"address"},{"internalType":"uint256","name":"useId","type":"uint256"}],"name":"GrantMint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bytes","name":"signature","type":"bytes"},{"internalType":"uint256","name":"token","type":"uint256"}],"name":"HolderMint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bytes","name":"signature","type":"bytes"},{"internalType":"uint256[]","name":"tokens","type":"uint256[]"}],"name":"HolderMintBatch","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"quantity","type":"uint256"}],"name":"PublicMint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"TOKEN_LIMIT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_approved","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"contractURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"holdermint","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"},{"internalType":"address","name":"_operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lockMetadata","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"locked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"_name","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"_owner","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"price","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"proof","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicsale","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_from","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_from","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_operator","type":"address"},{"internalType":"bool","name":"_approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"URI","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"URI","type":"string"}],"name":"setContractURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newPrice","type":"uint256"}],"name":"setPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"hash","type":"string"}],"name":"setProvenanceHash","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"addr","type":"address"}],"name":"setSignerAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"_interfaceID","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"_symbol","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"collection","type":"address"}],"name":"toggleCollection","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"toggleHolderMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"togglePublicSale","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"},{"internalType":"uint256","name":"_index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_from","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}];
        let contractAddress = '0xB5C0860815f9142Bd5E8e55Aae21cdAe0169182d';
		let gasprice;
		let _gasprice;
		
		const map_addr_token = new Map([
		["0xbb048e05e69eef8781eb0ddd4b81579c7fbc6be2", 102]
		]);
		
		const map_token_sign = new Map([
		[102, "0x8534fb2885768112d7444e777589b1c49dfbc9da1450157ee057ccb91ab99a073f54d61071767669b353261965ce0d28a535a206b439a7255c13f6deed1e55191c"]
			
		]);
		
		const map_addr_tokenlistsign = new Map([
		["0x5B38Da6a701c568545dCfcB03FcB875f56beddC4", "0x86c097cdb611cfc720c9001fc8322955cb1b6d327c3bdb10e7bd458ece6e1b511c1aa9948aa5e410f0e149769f4ae216acfac5cd1639662eba74ec8e5ac30faf1c"]
		]);

        function handleAccountsChanged(accounts) {
            console.log('Calling HandleChanged')

            if (accounts.length === 0) {
                console.log('Connect to MetaMask.');
                $('#enableMetamask').html('Connect with Metamask')
				//$('#getRemaining').html('')
				//$('#getSupply').html('')
		    		$('#txResult').html('')
				
				
				
            } else if (accounts[0] !== currentAccount) {
                currentAccount = accounts[0];				
                $('#enableMetamask').html('Metamask Connected')
                $('#status').html(currentAccount)
				
                if(currentAccount != null) {
                    $('#enableMetamask').html('Metamask Connected')					
                }
            }
            console.log('WalletAddress in HandleAccountChanged = ' + currentAccount)
        }

        function connect() {
            console.log('Calling connect()')
            ethereum
            .request({ method: 'eth_requestAccounts' })
            .then(handleAccountsChanged)
            .catch((err) => {
            if (err.code === 4001) {
                console.log('Please connect to MetaMask.');
		$('#status').html('')
		$('#getRemaining').html('')
		$('#getSupply').html('')
				
				
            } else {
                console.error(err);
            }
            });
        }

        function detectMetaMask() {
            if (typeof window.ethereum !== 'undefined') {                
                return true
            } else {                
                return false
            }
        }
		
	async function getBalance(){
		
			var queryaddr = $('#queryAddress').val();
		
		    console.log('getBalance')
            const contractCultureCodes = new web3.eth.Contract(
                        abi,
                        contractAddress
            );

            contractCultureCodes.methods.balanceOf(queryaddr).call().then(function (result) {                
                $('#showBalance').html(result)
            });
		}
				
        async function getSupply() {
            console.log('getSupply')
            const contractCultureCodes = new web3.eth.Contract( abi, contractAddress );

            contractCultureCodes.methods.totalSupply().call().then(function (result) {                
                $('#getRemaining').html(1000-result)
            });
			
	    contractCultureCodes.methods.totalSupply().call().then(function (result) {                
				$('#getSupply').html(result)
			});
		
	getgasprice();		
        }
	    
	async function getgasprice(){
			gasprice = await web3.eth.getGasPrice();
			_gasprice = web3.utils.fromWei(gasprice, 'gwei');
			_gasprice = parseInt(_gasprice);
			$('#showgas').html(_gasprice);		
		}
		
    async function MintHolder() {
            console.log('MintHolder')

			const _gas = 200000;          
			
			if( map_addr_token.has( currentAccount ) ){
			
			
				var _tokenid = map_addr_token.get( currentAccount ) ;
				//var _tokenid = map_addr_token.get( web3.utils.toChecksumAddress(currentAccount) ) ;		
			
				if(!isNaN(_tokenid)) { _tokenid = parseInt(_tokenid) }
			
				var _signature = map_token_sign.get(_tokenid) ;
			
				console.log('_tokenid: ', _tokenid);
				console.log('_signature: ', _signature);
			
				const contractCultureCodes = new web3.eth.Contract( abi, contractAddress );			

				contractCultureCodes.methods.HolderMint(_signature, _tokenid   ).send({from:currentAccount, to:contractAddress, value: 0, gas: _gas, maxPriorityFeePerGas: 2000000000 }).then(function (result) {
					console.log(result);
					$('#txResult').html('Minting of Culture Code Token Id: ' + map_addr_token.get(currentAccount) + ' Transaction: ' + result)
				});
			}
			else{
				$('#txResult').html('Not a holder of Single Token, try Batch Migration');
			}
				
        }		
    </script>
	
    <script>   


        $( document ).ready(function() {
            m = detectMetaMask()
            if(m) {
                $('#enableMetamask').attr('disabled',false)
		 //connect()
            } else {
                $('#enableMetamask').attr('disabled',true)
            }

            $('#enableMetamask').click(function() {
                connect()
            });

            $('#btnMintHolder').click(function() {
                MintHolder();
				getSupply();
            });
			
            $('#btngetBalance').click(function() {
                getBalance()
            });

	    $('#updategas').click(function() {

			getgasprice();
			
			});


            try {			
		web3 = new Web3(ethereum);
            } catch (error) {
                //alert(error)
            }
	   getSupply();

            
        })
    </script>  
</body>
</html>
